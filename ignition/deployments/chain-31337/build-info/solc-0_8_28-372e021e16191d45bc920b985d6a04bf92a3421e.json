{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-372e021e16191d45bc920b985d6a04bf92a3421e",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/ChainPOS.sol": "project/contracts/ChainPOS.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/ChainPOS.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.20;\n\n/**\n * @title ChainPOS\n * @notice Decentralized point-of-sale system for multi-vendor markets\n */\ncontract ChainPOS {\n\n    // ── State Variables ──────────────────────────────────────────────\n    address public owner;\n    address public executor;\n    address public platformWallet;\n    address public taxWallet;\n\n    uint256 public platformFeeBps;\n    uint256 public taxBps;\n\n    bool public settlementExecuted;\n    uint256 public currentCycle;\n\n    // ── Data Structures ──────────────────────────────────────────────\n    struct Vendor {\n        address wallet;\n        string name;\n        bool registered;\n        uint256 pendingBalance;\n    }\n\n    struct Transaction {\n        address vendor;\n        string itemRef;\n        uint256 amount;\n        uint256 timestamp;\n    }\n\n    mapping(address => Vendor) public vendors;\n    mapping(address => mapping(string => uint256)) public itemPrices;\n\n    address[] public vendorList;\n    Transaction[] public transactions;\n\n    // ── Events ───────────────────────────────────────────────────────\n    event VendorRegistered(address indexed vendor, string name);\n    event VendorRemoved(address indexed vendor);\n    event ItemRegistered(address indexed vendor, string itemRef, uint256 price);\n    event Deposit(address indexed customer, address indexed vendor, string itemRef, uint256 amount);\n    event SettlementExecuted(uint256 cycle, uint256 totalAmount);\n    event ExecutorChanged(address indexed oldExecutor, address indexed newExecutor);\n\n    // ── Modifiers ────────────────────────────────────────────────────\n    modifier onlyOwner() {\n        require(msg.sender == owner, \"ChainPOS: Not owner\");\n        _;\n    }\n\n    modifier onlyExecutor() {\n        require(msg.sender == executor, \"ChainPOS: Not executor\");\n        _;\n    }\n\n    modifier onlyRegisteredVendor() {\n        require(vendors[msg.sender].registered, \"ChainPOS: Not a registered vendor\");\n        _;\n    }\n\n    modifier settlementNotExecuted() {\n        require(!settlementExecuted, \"ChainPOS: Settlement already executed this cycle\");\n        _;\n    }\n\n    // ── Constructor ──────────────────────────────────────────────────\n    constructor(\n        address _executor,\n        address _platformWallet,\n        address _taxWallet,\n        uint256 _platformFeeBps,\n        uint256 _taxBps\n    ) {\n        require(_executor != address(0), \"Invalid executor\");\n        require(_platformWallet != address(0), \"Invalid platform wallet\");\n        require(_taxWallet != address(0), \"Invalid tax wallet\");\n        require(_platformFeeBps + _taxBps < 10000, \"Fees exceed 100%\");\n\n        owner = msg.sender;\n        executor = _executor;\n        platformWallet = _platformWallet;\n        taxWallet = _taxWallet;\n        platformFeeBps = _platformFeeBps;\n        taxBps = _taxBps;\n        currentCycle = 1;\n    }\n\n    // ── Owner Functions ──────────────────────────────────────────────\n    function registerVendor(address _vendor, string calldata _name) external onlyOwner {\n        require(_vendor != address(0), \"Invalid vendor address\");\n        require(!vendors[_vendor].registered, \"Vendor already registered\");\n\n        vendors[_vendor] = Vendor({\n            wallet: _vendor,\n            name: _name,\n            registered: true,\n            pendingBalance: 0\n        });\n        vendorList.push(_vendor);\n\n        emit VendorRegistered(_vendor, _name);\n    }\n\n    function removeVendor(address _vendor) external onlyOwner {\n        require(vendors[_vendor].registered, \"Vendor not registered\");\n        require(vendors[_vendor].pendingBalance == 0, \"Vendor has pending balance\");\n\n        vendors[_vendor].registered = false;\n        emit VendorRemoved(_vendor);\n    }\n\n    function setExecutor(address _newExecutor) external onlyOwner {\n        require(_newExecutor != address(0), \"Invalid executor\");\n        address old = executor;\n        executor = _newExecutor;\n        emit ExecutorChanged(old, _newExecutor);\n    }\n\n    // ── Vendor Functions ─────────────────────────────────────────────\n    function registerItem(string calldata _itemRef, uint256 _price) external onlyRegisteredVendor {\n        require(_price > 0, \"Price must be greater than zero\");\n        itemPrices[msg.sender][_itemRef] = _price;\n        emit ItemRegistered(msg.sender, _itemRef, _price);\n    }\n\n    // ── Payment Function ─────────────────────────────────────────────\n    function pay(address _vendor, string calldata _itemRef) external payable settlementNotExecuted {\n        require(vendors[_vendor].registered, \"Vendor not registered\");\n        uint256 price = itemPrices[_vendor][_itemRef];\n        require(price > 0, \"Item not found\");\n        require(msg.value == price, \"Incorrect payment amount\");\n\n        vendors[_vendor].pendingBalance += msg.value;\n\n        transactions.push(Transaction({\n            vendor: _vendor,\n            itemRef: _itemRef,\n            amount: msg.value,\n            timestamp: block.timestamp\n        }));\n\n        emit Deposit(msg.sender, _vendor, _itemRef, msg.value);\n    }\n\n    // ── Settlement Function ──────────────────────────────────────────\n    function executeSettlement() external onlyExecutor settlementNotExecuted {\n        uint256 total = address(this).balance;\n        require(total > 0, \"Nothing to settle\");\n\n        uint256 platformCut = (total * platformFeeBps) / 10000;\n        uint256 taxCut = (total * taxBps) / 10000;\n        uint256 vendorPool = total - platformCut - taxCut;\n\n        // Pay platform and tax\n        (bool p,) = platformWallet.call{value: platformCut}(\"\");\n        require(p, \"Platform transfer failed\");\n\n        (bool t,) = taxWallet.call{value: taxCut}(\"\");\n        require(t, \"Tax transfer failed\");\n\n        // Distribute to vendors proportionally\n        uint256 distributed = 0;\n        for (uint256 i = 0; i < vendorList.length; i++) {\n            address v = vendorList[i];\n            if (vendors[v].pendingBalance > 0) {\n                uint256 share = (vendors[v].pendingBalance * vendorPool) / total;\n                vendors[v].pendingBalance = 0;\n                distributed += share;\n                (bool s,) = v.call{value: share}(\"\");\n                require(s, \"Vendor transfer failed\");\n            }\n        }\n\n        settlementExecuted = true;\n        emit SettlementExecuted(currentCycle, total);\n    }\n\n    // ── Cycle Reset (Owner only) ─────────────────────────────────────\n    function resetCycle() external onlyOwner {\n        require(settlementExecuted, \"Current cycle not yet settled\");\n        settlementExecuted = false;\n        currentCycle += 1;\n    }\n\n    // ── View Functions ───────────────────────────────────────────────\n    function getContractBalance() external view returns (uint256) {\n        return address(this).balance;\n    }\n\n    function getVendorBalance(address _vendor) external view returns (uint256) {\n        return vendors[_vendor].pendingBalance;\n    }\n\n    function getVendorCount() external view returns (uint256) {\n        return vendorList.length;\n    }\n\n    function getTransactionCount() external view returns (uint256) {\n        return transactions.length;\n    }\n\n    function getItemPrice(address _vendor, string calldata _itemRef) external view returns (uint256) {\n        return itemPrices[_vendor][_itemRef];\n    }\n\n    function isVendorRegistered(address _vendor) external view returns (bool) {\n        return vendors[_vendor].registered;\n    }\n\n    function isExecutor(address _addr) external view returns (bool) {\n        return _addr == executor;\n    }\n\n    // ── Fallback ─────────────────────────────────────────────────────\n    receive() external payable {\n        revert(\"Use pay() function\");\n    }\n}"
      }
    }
  }
}